#!/bin/sh

EXE=${EXE:-a.out}

SRC=$(find . -name '*.c')
INC=$(find . -name '*.h')
OBJ=$(find . -name '*.c' | sed 's/\.c$/.o/')

_cmd() {
	command -v "$1" > /dev/null
}

CFLAGS='-std=c99 -Wall -pedantic'
LDFLAGS='-lcurses'

if _cmd clang; then
	CC='clang'
	CFLAGS='-std=c99 -Weverything'
elif _cmd gcc; then
	CC='gcc'
else
	CC='c99'
fi

cat <<EOF > Makefile
.PHONY: clean

${EXE}: ${OBJ} ${INC}
	${CC} ${CFLAGS} ${LDFLAGS} ${SRC} -o ${EXE}

clean:
	@rm -fv ${EXE} ${OBJ}
EOF
